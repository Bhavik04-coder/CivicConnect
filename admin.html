<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicConnect - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary: #4F46E5;
            --primary-light: #6366F1;
            --primary-dark: #3730A3;
            --secondary: #1F2937;
            --secondary-light: #374151;
            --accent: #EF4444;
            --success: #10B981;
            --warning: #F59E0B;
            --info: #3B82F6;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --white: #FFFFFF;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --gradient-warning: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --gradient-danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -5px rgba(0, 0, 0, 0.1), 0 5px 5px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            margin-right: 8px;
            font-size: 1.4rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-details {
            display: none;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--gray-500);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-badge {
            background: var(--gradient-primary);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .logout-btn {
            background: var(--gray-100);
            color: var(--gray-700);
            border: none;
            padding: 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .logout-btn:hover {
            background: var(--gray-200);
            transform: translateY(-1px);
        }

        .logout-btn .text {
            display: none;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            padding: 2rem 0 1.5rem;
            background: var(--gradient-primary);
            color: white;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding: 0 0.5rem;
        }

        .page-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            padding: 0 1rem;
        }

        /* Stats Cards */
        .stats-section {
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: 1.25rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--gray-100);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-card:active {
            transform: scale(0.98);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.75rem;
            font-size: 1.5rem;
            color: white;
            position: relative;
        }

        .stat-card:nth-child(1) .stat-icon {
            background: var(--gradient-primary);
        }

        .stat-card:nth-child(2) .stat-icon {
            background: var(--gradient-success);
        }

        .stat-card:nth-child(3) .stat-icon {
            background: var(--gradient-warning);
        }

        .stat-number {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
            display: block;
        }

        .stat-label {
            color: var(--gray-600);
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        .stat-change {
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.neutral {
            color: var(--gray-500);
        }

        /* Filters */
        .filters-section {
            margin-bottom: 2rem;
        }

        .filters-card {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper::after {
            content: "\f078";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            pointer-events: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: var(--primary);
            color: white;
            padding: 0.875rem 1.25rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            text-align: center;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-block {
            width: 100%;
        }

        /* Issues Section */
        .issues-section {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .issues-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .issue-card {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--gray-100);
        }

        .issue-card:active {
            transform: scale(0.99);
        }

        .issue-image {
            height: 160px;
            overflow: hidden;
            position: relative;
        }

        .issue-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .issue-content {
            padding: 1.5rem;
        }

        .issue-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .issue-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
            line-height: 1.4;
        }

        .issue-category {
            display: inline-block;
            background: var(--gradient-primary);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .issue-description {
            margin-bottom: 1rem;
            color: var(--gray-600);
            line-height: 1.5;
            font-size: 0.9rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .issue-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-100);
            font-size: 0.85rem;
        }

        .issue-date {
            color: var(--gray-500);
            font-weight: 500;
        }

        .issue-reporter {
            color: var(--gray-500);
            font-weight: 500;
        }

        .issue-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            justify-content: center;
        }

        .status-submitted {
            background: rgba(251, 191, 36, 0.1);
            color: #D97706;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .status-progress {
            background: rgba(59, 130, 246, 0.1);
            color: #2563EB;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .status-resolved {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* Loading States */
        .loading-container {
            text-align: center;
            padding: 3rem 1rem;
            grid-column: 1 / -1;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid var(--gray-200);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--gray-600);
            font-size: 1rem;
            font-weight: 500;
        }

        /* Error Message */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent);
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            display: none;
            text-align: center;
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray-500);
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-300);
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--gray-600);
        }

        .empty-state p {
            font-size: 1rem;
        }

        /* Footer */
        .footer {
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            padding: 2rem 0;
            margin-top: 3rem;
            text-align: center;
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .footer p {
            margin-bottom: 0.5rem;
        }

        /* Bottom Navigation for Mobile */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-around;
            padding: 0.75rem;
            z-index: 90;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray-500);
            font-size: 0.75rem;
            padding: 0.5rem;
            border-radius: 10px;
            transition: var(--transition);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }

        .nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        /* Swipe to refresh */
        .pull-to-refresh {
            text-align: center;
            padding: 1rem;
            color: var(--gray-500);
            display: none;
        }

        /* Responsive Design */
        @media (min-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .filters-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .issue-meta {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        @media (min-width: 768px) {
            .nav-container {
                padding: 0 2rem;
                height: 70px;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .logo i {
                font-size: 1.8rem;
            }
            
            .user-details {
                display: flex;
            }
            
            .logout-btn {
                padding: 0.75rem 1.5rem;
                width: auto;
                height: auto;
            }
            
            .logout-btn .text {
                display: inline;
            }
            
            .page-title {
                font-size: 2.5rem;
            }
            
            .page-subtitle {
                font-size: 1.1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
            
            .stat-card {
                padding: 1.5rem;
            }
            
            .stat-icon {
                width: 60px;
                height: 60px;
                font-size: 1.75rem;
            }
            
            .stat-number {
                font-size: 2.25rem;
            }
            
            .filters-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .issues-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
            
            .issue-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .issue-title {
                margin-right: 1rem;
                font-size: 1.25rem;
            }
            
            .issue-status {
                width: auto;
            }
            
            .mobile-nav {
                display: none;
            }
        }

        @media (min-width: 1024px) {
            .container {
                padding: 0 2rem;
            }
            
            .page-title {
                font-size: 3rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-xl);
            }
            
            .issue-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-xl);
            }
            
            .issue-card:hover .issue-image img {
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <a href="login.html" class="logo">
                <i class="fas fa-city"></i>
                CivicConnect
            </a>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-role">
                        <span class="admin-badge">Admin</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="text">Logout</span>
                </button>
            </div>
        </div>
    </header>

    <div class="page-header">
        <div class="container">
            <h1 class="page-title">System Analytics Dashboard</h1>
            <p class="page-subtitle">
                Monitor system performance, track issue resolution trends, and gain insights into community engagement
            </p>
        </div>
    </div>

    <div class="container">
        <div id="firebaseError" class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            Could not connect to Firebase. Showing sample data instead.
        </div>

        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <span class="stat-number" id="totalIssues">0</span>
                    <div class="stat-label">Total Issues</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+12%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <span class="stat-number" id="resolvedIssues">0</span>
                    <div class="stat-label">Resolved</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+18%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <span class="stat-number" id="pendingIssues">0</span>
                    <div class="stat-label">Pending</div>
                    <div class="stat-change neutral">
                        <i class="fas fa-minus"></i>
                        <span>Same</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="filters-section">
            <div class="filters-card">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="adminFilterCategory" class="filter-label">Category</label>
                        <div class="select-wrapper">
                            <select id="adminFilterCategory" class="form-control">
                                <option value="">All Categories</option>
                                <option value="Roads">Roads & Sidewalks</option>
                                <option value="Parks">Parks & Recreation</option>
                                <option value="Trash">Trash & Recycling</option>
                                <option value="Water">Water & Sewage</option>
                                <option value="Lights">Street Lights</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label for="adminFilterStatus" class="filter-label">Status</label>
                        <div class="select-wrapper">
                            <select id="adminFilterStatus" class="form-control">
                                <option value="">All Statuses</option>
                                <option value="Submitted">Submitted</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Resolved">Resolved</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-block" onclick="applyAdminFilters()">
                            <i class="fas fa-filter"></i>
                            Apply Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="issues-section">
            <div class="section-header">
                <h2 class="section-title">Community Issues</h2>
            </div>
            
            <div class="issues-grid" id="adminIssuesList">
                <div class="loading-container">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading issues...</div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p><strong>CivicConnect</strong> &copy; 2023. Building better communities together.</p>
            <p>Advanced analytics and monitoring for system administrators.</p>
        </div>
    </footer>

    <nav class="mobile-nav">
        <a href="#" class="nav-item active">
            <i class="fas fa-chart-pie"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-tasks"></i>
            <span>Issues</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
        <a href="#" class="nav-item" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </a>
    </nav>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyArphfBGx8Xsc91e-mGnCMgLAPngdjW49U",
            authDomain: "asep2-3fa6a.firebaseapp.com",
            projectId: "asep2-3fa6a",
            storageBucket: "asep2-3fa6a.firebasestorage.app",
            messagingSenderId: "628533983257",
            appId: "1:628533983257:web:2887414b881353f72d5288",
            measurementId: "G-2PE852LGZB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Global variables
        let issues = [];
        let filteredIssues = [];

        // Sample data to use if Firebase fails
        const sampleIssues = [
            {
                id: "1",
                title: "Pothole on Main Street",
                category: "Roads",
                description: "Large pothole near the intersection of Main Street and 5th Avenue causing traffic issues.",
                status: "Submitted",
                date: new Date().toISOString(),
                reportedBy: "John Smith",
                image: "https://images.unsplash.com/photo-1563453392212-326f5e854473?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80"
            },
            {
                id: "2",
                title: "Broken Swing in City Park",
                category: "Parks",
                description: "One of the swings in the children's playground is broken and needs repair.",
                status: "In Progress",
                date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                reportedBy: "Emily Johnson",
                image: "https://images.unsplash.com/photo-1577702312571-5c12c59ad0ab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1074&q=80"
            },
            {
                id: "3",
                title: "Overflowing Trash Bin",
                category: "Trash",
                description: "Public trash bin at the bus station is overflowing and attracting pests.",
                status: "Submitted",
                date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                reportedBy: "Michael Brown",
                image: "https://images.unsplash.com/photo-1621510456687-6cd00968a3ff?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80"
            },
            {
                id: "4",
                title: "Water Leak on Oak Avenue",
                category: "Water",
                description: "Water is leaking from a broken pipe near the sidewalk on Oak Avenue.",
                status: "Resolved",
                date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                reportedBy: "Sarah Wilson",
                image: "https://images.unsplash.com/photo-1629909613651-7e46cc5d8d40?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1172&q=80"
            },
            {
                id: "5",
                title: "Flickering Street Light",
                category: "Lights",
                description: "Street light on Maple Street flickers intermittently and sometimes doesn't turn on at night.",
                status: "In Progress",
                date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                reportedBy: "Robert Davis",
                image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80"
            },
            {
                id: "6",
                title: "Graffiti on Public Library",
                category: "Other",
                description: "Vandalism with spray paint on the west side of the public library building.",
                status: "Submitted",
                date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                reportedBy: "Lisa Miller",
                image: "https://images.unsplash.com/photo-1584824486537-52a33900459f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80"
            }
        ];

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is authenticated
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    document.getElementById('userName').textContent = user.displayName || user.email;
                    document.getElementById('userAvatar').innerHTML = user.displayName ? 
                        user.displayName.charAt(0).toUpperCase() : 
                        '<i class="fas fa-user-shield"></i>';
                    
                    // Load admin data
                    loadAdminIssues();
                } else {
                    // No user is signed in, redirect to login
                    window.location.href = 'login.html';
                }
            });
            
            // Add touch events for better mobile interaction
            initTouchEvents();
        });

        // Initialize touch events for mobile
        function initTouchEvents() {
            // Add touch feedback to buttons and cards
            const touchElements = document.querySelectorAll('.btn, .stat-card, .issue-card');
            
            touchElements.forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.classList.add('touch-active');
                }, {passive: true});
                
                element.addEventListener('touchend', function() {
                    this.classList.remove('touch-active');
                }, {passive: true});
            });
        }

        // Logout function
        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }

        // Load admin issues from Firestore with fallback to sample data
        function loadAdminIssues() {
            const issuesList = document.getElementById('adminIssuesList');
            issuesList.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading issues...</div>
                </div>
            `;
            
            // Try to load from Firebase
            try {
                db.collection("issues").get()
                    .then((querySnapshot) => {
                        issues = [];
                        if (!querySnapshot.empty) {
                            querySnapshot.forEach((doc) => {
                                const issueData = doc.data();
                                issueData.id = doc.id;
                                issues.push(issueData);
                            });
                        } else {
                            // Use sample data if Firebase collection is empty
                            document.getElementById('firebaseError').style.display = 'block';
                            issues = sampleIssues;
                        }
                        
                        updateAdminStats();
                        displayIssues(issues);
                    })
                    .catch((error) => {
                        console.error("Error getting issues from Firebase: ", error);
                        // Show error message and use sample data if Firebase fails
                        document.getElementById('firebaseError').style.display = 'block';
                        issues = sampleIssues;
                        updateAdminStats();
                        displayIssues(issues);
                    });
            } catch (error) {
                console.error("Firebase error: ", error);
                // Show error message and use sample data if Firebase is not available
                document.getElementById('firebaseError').style.display = 'block';
                issues = sampleIssues;
                updateAdminStats();
                displayIssues(issues);
            }
        }

        // Update admin stats
        function updateAdminStats() {
            const totalIssues = issues.length;
            const resolvedIssues = issues.filter(issue => issue.status === 'Resolved').length;
            const pendingIssues = totalIssues - resolvedIssues;
            
            document.getElementById('totalIssues').textContent = totalIssues;
            document.getElementById('resolvedIssues').textContent = resolvedIssues;
            document.getElementById('pendingIssues').textContent = pendingIssues;
        }

        // Display issues in the UI
        function displayIssues(issuesToDisplay) {
            const issuesList = document.getElementById('adminIssuesList');
            
            if (issuesToDisplay.length === 0) {
                issuesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No issues found</h3>
                        <p>No issues match your current filters.</p>
                    </div>
                `;
                return;
            }
            
            issuesList.innerHTML = '';
            
            issuesToDisplay.forEach(issue => {
                const statusClass = `status-${issue.status.toLowerCase().replace(' ', '-')}`;
                
                const issueCard = document.createElement('div');
                issueCard.className = 'issue-card';
                issueCard.innerHTML = `
                    <div class="issue-image">
                        <img src="${issue.image || issue.imageUrl || 'https://images.unsplash.com/photo-1589652717521-10c0d092dea9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80'}" 
                             alt="${issue.title}"
                             onerror="this.src='https://images.unsplash.com/photo-1589652717521-10c0d092dea9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80'">
                    </div>
                    <div class="issue-content">
                        <div class="issue-header">
                            <h3 class="issue-title">${issue.title}</h3>
                            <span class="issue-category">${issue.category}</span>
                        </div>
                        <p class="issue-description">${issue.description}</p>
                        <div class="issue-meta">
                            <span class="issue-date">${formatDate(issue.date || issue.timestamp)}</span>
                            <span class="issue-reporter">By: ${issue.reportedBy || issue.reporter || 'Anonymous'}</span>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <span class="issue-status ${statusClass}">${issue.status}</span>
                        </div>
                    </div>
                `;
                
                issuesList.appendChild(issueCard);
            });
        }

        // Apply filters for admin view
        function applyAdminFilters() {
            const categoryFilter = document.getElementById('adminFilterCategory').value;
            const statusFilter = document.getElementById('adminFilterStatus').value;
            
            filteredIssues = issues.filter(issue => {
                return (!categoryFilter || issue.category === categoryFilter) &&
                       (!statusFilter || issue.status === statusFilter);
            });
            
            displayIssues(filteredIssues);
        }

        // Format date for display
        function formatDate(dateValue) {
            if (!dateValue) return 'Date not available';
            
            try {
                // If it's a Firebase timestamp
                if (dateValue.toDate) {
                    return dateValue.toDate().toLocaleDateString();
                }
                
                // If it's a string
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateValue).toLocaleDateString(undefined, options);
            } catch (error) {
                console.error('Error formatting date:', error);
                return 'Invalid date';
            }
        }
    </script>
</body>
</html>